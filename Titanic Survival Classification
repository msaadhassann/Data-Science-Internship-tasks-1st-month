import pandas as pd
import seaborn as sns
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score

# 1. Load the dataset
df = sns.load_dataset('titanic')

# 2. PREPROCESSING (Fixes the ValueError from your screenshot)
# We drop 'class' because it contains strings like 'First', 'Second'
df = df.drop(columns=['class', 'who', 'deck', 'embark_town', 'alive', 'adult_male'])

# Handle missing values
df['age'] = df['age'].fillna(df['age'].median())
df['embarked'] = df['embarked'].fillna(df['embarked'].mode()[0])

# Convert 'sex' to numbers (0 and 1)
df['sex'] = df['sex'].map({'male': 0, 'female': 1})
df = pd.get_dummies(df, columns=['embarked'], drop_first=True)

# 3. SPLIT DATA
X = df.drop('survived', axis=1)
y = df['survived']
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# 4. TRAIN THE MODEL
model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X_train, y_train)

# 5. MAKE PREDICTIONS
predictions = model.predict(X_test)

# 6. CALCULATE RESULTS
accuracy = accuracy_score(y_test, predictions)
total_passengers = len(predictions)
survived_count = sum(predictions)  # Adds up all the 1s
died_count = total_passengers - survived_count

# --- OUTPUT ---
print("-" * 30)
print(f"MODEL PERFORMANCE")
print(f"Accuracy: {accuracy:.2%}")
print("-" * 30)
print(f"PREDICTION RESULTS (on {total_passengers} test passengers)")
print(f"Predicted to Survive: {survived_count}")
print(f"Predicted to Perish:  {died_count}")
print("-" * 30)
